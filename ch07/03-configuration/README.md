# 도커 컴포즈 작성법
## 주 항목
|항목|내용|`docker run` 커맨드의 해당 옵션|
|---|---|---|
|version|버전 명시||
|services|컨테이너 정의||
|image|사용할 이미지를 지정|이미지 인자|
|networks|네트워크 정의|--net|
|volumes|볼륨 정의|-v, --mount|
|ports|포트 설정|-p|
|environment|환경변수 설정|-e|
|depends_on|다른 서비스에 대한 의존관계를 정의||
|`restart`|컨테이너 종료시 재시작 여부 설정||

## `restart` 설정값
|설정값|내용|
|---|---|
|no|재시작하지 않는다.|
|always|항상 재시작한다.|
|on-failure|프로세스가 0 외의 상태로 종료됐다면 재시작한다.|
|unless-stopped|종료 시 재시작하지 않음. 그 외에는 재시작한다.|

## 그 외 정의 항목
|항목|내용|`docker run` 커맨드의 해당 옵션|
|---|---|---|
|command|컨테이너 시작 시 기존 커맨드를 오버라이드|커맨드 인자|
|container_name|실행할 컨테이너의 이름을 명시적으로 지정|--name|
|dns|DNS 서버를 명시적으로 지정|--dns|
|env_file|환경설정 정보를 기재한 파일을 로드||
|entrypoint|컨테이너 시작시 ENTRYPOINT 설정을 오버라이드|--entrypoint|
|external_links|외부 링크를 설정|--link|
|extra_hosts|외부 호스트의 IP 주소를 명시적으로 지정|--add-host|
|logging|로그 출력 대상을 설정|--log-driver|
|network_mode|네트워크 모드를 설정|--network|

## 주의점
*예시) docker-composer.compoare.yml*
- services 등의 주 항목 아래에는 이름을 기재한다. 
- 이름은 주 항목보다 한단 들여쓰기해서 적는다.
    - 한 단의 공백 개수는 몇개여도 상관 없으나, `tap`은 사용할 수 없다.
    - YML 형식에서는 공백에 따라 의미가 달라지므로 `tap`은 의미가 없다.
    - 공백 2개로 맨처음 들여쓰기를 했다면 그 뒤로도 공백 2개가 한 단이 돼야한다.
- 이름 뒤에 반드시 콜론(`:`)을 붙인다.
    - 해당 줄에 이어서 설정을 기재하려면 콜론 뒤로 공백이 하나 있어야 한다.
        > 이 자리에 공백을 넣는 것을 잊어버리기 쉽기 떄문에 오류가 발생한다면 이것부터 확인하는 것이 좋다.
- 기재할 내용이 여러 개라면 줄을 바꿔 하이픈(`-`)을 앞에 적고 들여쓰기를 맞춘다.
- *컨테이너 이름은 섣불리 손대지 않는 것이 좋다.*
    - 도커 컴포즈를 사용해 penguin이라는 컨테이너를 만든 다음, 도커 엔진을 통해 이 컨테이너의 이름을 penguin000sepcial로 바꾸더라도 컴포즈 파일에서는 이를 알 수 없다.
    - 그러므로 나중에 도커 컴포즈로 컨테이너를 정지, 삭제하려고 해도 컴포즈 파일에 기재된 이름과 컨테이너의 실제 이름이 일치하지 않아 컨테이너를 정지할 수 없다.
    - 반대로 컨테이너의 이름은 그대로인데 컴포즈 파일에 기재된 컨테이너 이름을 주어해도 마찬가지 상황이 발생한다.

